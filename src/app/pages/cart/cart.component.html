<!-- <app-articles-header
  [title]="'cart.header.title' | translate"
  [subTitle]="'cart.header.subtitle' | translate"
  [showRotateImage]="false"
  [marginBottom]="'9'"
></app-articles-header> -->

<section>
  <div class="container mx-auto px-4 py-8">
    <h1 class="text-2xl font-bold mb-8">Shopping Cart</h1>

    @if (_cartState.isEmpty()) {
    <div class="bg-white rounded-lg shadow-md p-8 text-center">
      <svg
        xmlns="http://www.w3.org/2000/svg"
        class="h-16 w-16 mx-auto text-gray-400 mb-4"
        fill="none"
        viewBox="0 0 24 24"
        stroke="currentColor"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"
        />
      </svg>
      <h2 class="text-xl font-semibold mb-2">Your cart is empty</h2>
      <p class="text-gray-600 mb-6">
        Looks like you haven't added any products to your cart yet.
      </p>
      <a
        [routerLink]="['/', currentLang$ | async, 'shopping']"
        class="bg-primary text-white py-2 px-6 rounded-md hover:bg-primary-dark transition duration-150 ease-in-out"
      >
        Continue Shopping
      </a>
    </div>
    } @else {
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
      <!-- Cart Items -->
      <div class="lg:col-span-2">
        <div class="bg-white rounded-lg shadow-md overflow-hidden">
          <div class="p-4 border-b flex justify-between items-center">
            <h2 class="text-lg font-semibold">
              Items ({{ _cartState.itemCount() }})
            </h2>
            <button
              (click)="clearCart()"
              class="text-red-500 hover:text-red-700 text-sm font-medium"
              aria-label="Remove all items"
            >
              Remove all
            </button>
          </div>

          @for (item of _cartState.items(); track item.productId) {
          <div class="p-4 border-b flex flex-col sm:flex-row gap-4">
            <!-- Product Image -->
            <div
              class="w-full sm:w-24 h-24 bg-gray-100 rounded-md overflow-hidden flex-shrink-0"
            >
              @if (item.image) {
              <img
                [src]="item.image"
                [alt]="item.name"
                class="w-full h-full object-cover"
              />
              } @else {
              <div
                class="w-full h-full bg-gray-200 flex items-center justify-center"
              >
                <span class="text-gray-400 text-xs">No image</span>
              </div>
              }
            </div>

            <!-- Product Details -->
            <div class="flex-1">
              <h3 class="text-lg font-medium mb-1">{{ item.name }}</h3>
              <p class="text-gray-500 text-sm mb-2">${{ item.price }}</p>

              <!-- Quantity Controls -->
              <div class="flex items-center mt-2">
                <button
                  (click)="updateQuantity(item.productId, item.quantity - 1)"
                  class="bg-gray-100 text-gray-600 hover:bg-gray-200 rounded-l-md px-3 py-1"
                  aria-label="Decrease quantity"
                >
                  -
                </button>
                <span class="px-4 py-1 bg-gray-50 text-center w-12">{{
                  item.quantity
                }}</span>
                <button
                  (click)="updateQuantity(item.productId, item.quantity + 1)"
                  class="bg-gray-100 text-gray-600 hover:bg-gray-200 rounded-r-md px-3 py-1"
                  aria-label="Increase quantity"
                >
                  +
                </button>

                <button
                  (click)="removeItem(item.productId)"
                  class="ml-4 text-red-500 hover:text-red-700"
                  aria-label="Remove item"
                >
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    class="h-5 w-5"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke="currentColor"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"
                    />
                  </svg>
                </button>
              </div>
            </div>

            <!-- Price -->
            <div class="text-right">
              <p class="text-lg font-semibold">
                ${{ (item.quantity * (item.price || 0)).toFixed(2) }}
              </p>
            </div>
          </div>
          }
        </div>
      </div>

      <!-- Order Summary -->
      <div class="lg:col-span-1">
        <div class="bg-white rounded-lg shadow-md p-6 sticky top-4">
          <h2 class="text-lg font-semibold mb-4">Order Summary</h2>

          <!-- Promo Code -->
          <form
            [formGroup]="promoCodeForm"
            (ngSubmit)="applyPromoCode()"
            class="mb-6"
          >
            <div class="flex flex-col space-y-2 mb-2">
              <label for="promo-code" class="text-sm font-medium text-gray-700"
                >Promo Code</label
              >
              <div class="flex">
                <input
                  type="text"
                  id="promo-code"
                  formControlName="code"
                  class="flex-1 border border-gray-300 rounded-l-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"
                  placeholder="Enter code"
                />
                <button
                  type="submit"
                  [disabled]="!promoCodeForm.valid"
                  class="bg-primary text-white px-4 py-2 rounded-r-md hover:bg-primary-dark transition duration-150 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed"
                >
                  Apply
                </button>
              </div>
            </div>

            @if (promoCodeError) {
            <p class="text-sm text-red-500 mt-1">{{ promoCodeError }}</p>
            } @if (promoCodeSuccess) {
            <p class="text-sm text-green-500 mt-1">{{ promoCodeSuccess }}</p>
            }
          </form>

          <!-- Summary Items -->
          <div class="space-y-3 border-b pb-4 mb-4">
            <div class="flex justify-between">
              <span class="text-gray-600">Subtotal</span>
              <span class="font-medium"
                >${{ _cartState.subtotal().toFixed(2) }}</span
              >
            </div>

            @if (_cartState.discount() > 0) {
            <div class="flex justify-between text-green-600">
              <span>Discount</span>
              <span>-${{ _cartState.discount().toFixed(2) }}</span>
            </div>
            } @if (_cartState.tax() > 0) {
            <div class="flex justify-between">
              <span class="text-gray-600">Tax</span>
              <span class="font-medium"
                >${{ _cartState.tax().toFixed(2) }}</span
              >
            </div>
            } @if (_cartState.shipping() > 0) {
            <div class="flex justify-between">
              <span class="text-gray-600">Shipping</span>
              <span class="font-medium"
                >${{ _cartState.shipping().toFixed(2) }}</span
              >
            </div>
            }
          </div>

          <!-- Total -->
          <div class="flex justify-between items-center mb-6">
            <span class="text-lg font-bold">Total</span>
            <span class="text-xl font-bold"
              >${{ _cartState.total().toFixed(2) }}</span
            >
          </div>

          <!-- Checkout Button -->
          <a
            routerLink="/checkout"
            class="block w-full bg-primary text-white text-center py-3 rounded-md hover:bg-primary-dark transition duration-150 ease-in-out"
          >
            Proceed to Checkout
          </a>

          <!-- Continue Shopping -->
          <a
            routerLink="/products"
            class="block w-full text-center text-gray-600 hover:text-gray-900 mt-4"
          >
            Continue Shopping
          </a>
        </div>
      </div>
    </div>
    }
  </div>
</section>
